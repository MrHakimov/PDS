\section{Согласованное глобальное состояние (согласованный срез).
Алгоритм Чанди-Лампорта. Запоминание сообщений на стороне отправителя.}

\begin{definition}
    \textit{Срезом} называется любое $G \subseteq E$, удовлетворяющее
    условию
    \[
        \forall e \in E, f \in G~ e < f \Lra e \in G
    .\]
\end{definition}

\begin{definition}
    Срез $G$ называется \textit{согласованным}, если
    \[
        \forall e \in E, f \in G~ e \to f \Lra e \in G
    .\]
\end{definition}

\begin{algorithm}(Чанди, Лампорт)
    \enewline
    \begin{itemize}
        \item Снача все процессы помечаются как белые (w).
        \item Процесс-инициатор запоминает свое состояние, помечается красным (r)
            и посылает токен всем соседям.
        \item При получении сообщения w-процесс запоминает свое состояние
            и становится красным, после чего посылает токен всем соседям.
        \item Запомненные состояния образуют согласованный срез.
    \end{itemize}
\end{algorithm}

\begin{remark}
    Алгоритм работает корректно только в случае, когда соблюдается FIFO
    порядок на сообщениях.
\end{remark}

\begin{remark}(Классификация сообщений)

    Сообщения делятся на 4 вида:
    \begin{itemize}
        \item ww-сообщения. Их не надо сохранять, состояние их уже учитывает. 
        \item rr-сообщения. Их не надо сохранять, они просто сами произойдут потом.
        \item wr-сообщения. Такие сообщения нужно обязательно сохранять для
            дальнейшего восстановления состояния системы.
        \item rw-сообщения. Таких не может быть по определению согласованного среза.
    \end{itemize}
\end{remark}

\begin{algorithm}(Запоминание сообщений на стороне отправителя)
    \enewline
    \begin{itemize}
        \item w-процесс обязательно отправляет токен-подтверждение на каждое
            полученное сообщение.
        \item Процесс-отправитель сохраняет только те сообщения, на которые
            не успело прийти подтверждение.
        \item r-процесс не отправляет токен-подтверждение, поэтому wr-сообщения
            и только они не удалятся из буфера.
        \item Буфер готов тогда, когда процесс становится красным. После этого
            он не может участвовать в wr-сообщениях.
    \end{itemize}
\end{algorithm} 

