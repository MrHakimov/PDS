\section{Общий порядок (total order). Алгоритм Лампорта.}

\begin{definition}
    Пусть в системе сообщения рассылаются нескольким получателям.
    Обозначим $\texttt{rcv}_p(m)$ -- события получения сообщения процессами
    $p \in \bP$. Будем говорить, что соблюдается \textit{общий порядок},
    если
    \[
        \not\exists m,n \in \bM,~ p,q \in \bP\colon~
        \texttt{rcv}_p(m) < \texttt{rcv}_p(n) \wedge
        \texttt{rcv}_q(n) < \texttt{rcv}_q(m)
    .\]
\end{definition}

\begin{remark}
    Для случая, когда сообщения отправляются только одному процессу, это
    свойство всегда выполняется.
\end{remark}

\begin{algorithm}(Централизованный алгоритм обеспечения общего порядка)

    Пусть в системе соблюдается FIFO порядок сообщений. Тогда если процесс
    $P$ хочет сделать рассылку сообщения, он сообщает об этом координатору,
    который в свою очередь рассылает сообщения в фиксированном порядке.
\end{algorithm}

\begin{remark}
    Централизованный алгоритм также обеспечивает причинно-согласованный порядок.
\end{remark}

\begin{algorithm}(Лампорт)
    
    Обобщим алгоритм взаимной блокировки. Пусть в системе соблюдается FIFO 
    порядок сообщений. Все multicast-сообщения придется заменить на broadcast.
    Процесс, собирающийся послать сообщения, берет ``билет'', соответствующий
    его логическому времени, и посылает \texttt{request} запрос всем другим
    процессам. Те, в свою очередь, отвечают ему \texttt{ok}. После того, как
    был получен \texttt{ok} от всех процессов, отправитель начинает рассылку.
    Как и в алгоритме Лампорта для взаимного исключения, порядок обработки сообщений
    определяется парой из билета и номера процесса.
\end{algorithm}

